import { z } from "zod";

export const listingSchema = z
  .object({
    titre: z.string().min(4, "Le titre doit contenir au moins 4 caractères"),
    type: z.enum(["villa", "appartement", "maison", "terrain", "commercial"], {
      required_error: "Veuillez sélectionner un type de propriété",
    }),
    prixMensuel: z.coerce
      .number()
      .int("Le prix doit être un nombre entier")
      .min(1000, "Le prix minimum est de 1000 FCFA"),
    quartier: z.string().min(2, "Le quartier doit contenir au moins 2 caractères"),
    ville: z.enum(
      [
        "ouaga",
        "bobo",
        "koudougou",
        "ouahigouya",
        "banfora",
        "kaya",
        "tenkodogo",
        "fada",
        "dedougou",
        "koupela",
      ],
      {
        required_error: "Veuillez sélectionner une ville",
      }
    ),
    publishMode: z.enum(["now", "schedule"], {
      required_error: "Veuillez sélectionner un mode de publication",
    }),
    scheduledAt: z.date().optional(),
    chambres: z.coerce.number().int().min(0).optional(),
    sdb: z.coerce.number().int().min(0).optional(),
    superficie: z.coerce.number().int().min(1).optional(),
    vehicules: z.coerce.number().int().min(0).optional(),
    description: z.string().max(1200, "La description ne peut pas dépasser 1200 caractères").optional(),
    photos: z
      .array(
        z.object({
          uri: z.string(),
          width: z.number(),
          height: z.number(),
        })
      )
      .min(3, "Au moins 3 photos sont requises")
      .max(15, "Maximum 15 photos autorisées"),
    equipements: z
      .array(z.enum(["wifi", "parking", "securite", "jardin", "solaires", "piscine", "meuble"]))
      .optional(),
    cautionMois: z.coerce.number().int().min(0).max(12).optional(),
    interdictions: z
      .array(z.enum(["no_animaux", "no_fumeurs", "no_etudiants", "no_colocation"]))
      .optional(),
  })
  .refine(
    (data) => {
      if (data.publishMode === "schedule") {
        return !!data.scheduledAt;
      }
      return true;
    },
    {
      message: "La date de publication est requise pour une publication programmée",
      path: ["scheduledAt"],
    }
  );

export type ListingDraft = z.infer<typeof listingSchema>;

// Step-specific schemas for partial validation
const step1BaseSchema = baseListingSchema.pick({

export const step1Schema = step1BaseSchema.refine(  titre: true,
  type: true,
  prixMensuel: true,
  quartier: true,
  ville: true,
  publishMode: true,
  scheduledAt: true,
}).refine(
  (data) => {
    if (data.publishMode === "schedule") {
      return !!data.scheduledAt;
    }
    return true;
  },
  {
    message: "La date de publication est requise pour une publication programmée",
    path: ["scheduledAt"],
  }
);

export const step2Schema = listingSchema.pick({
  chambres: true,
  sdb: true,
  superficie: true,
  vehicules: true,
  description: true,
  photos: true,
  equipements: true,
  cautionMois: true,
  interdictions: true,
});

